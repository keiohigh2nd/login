<%= stylesheet_link_tag "user_home", :media => "all" %>

<div class="main">
  <% if not @user.pushs.length == 0 %>
    <% @notification = "#{@user.pushs.length}件の通知" %>
    <% @url_push = "/users/#{@user.id}/pushes"%>
  <% end %>
  <h3>緊急連絡先: <%= @user.emergence %></h3>
  <h3>名前: <%= @user.name %></h3>
  <h3>希望所在地: <%= @user.name %></h3>
  <% if current_user?(@user) %>
    <p><%= link_to 'ユーザー情報の編集', edit_user_path, class: "btn btn-default btn-sm"%></p>
  <% end %>
</div>

<div class="fav">
    <%= link_to "医師検索", { :controller => :doctors, :action => :index }, :class=>"btn btn-info" %> //
    <%= link_to "推薦医師", { :controller => :users, :action => :recommendation, :id => @user.id }, :class=>"btn btn-success" %>
    <% if signed_in_doctor? %>
      <%= form_tag({controller: "users", action: "favorite" }, {method: "get"}) do %>
        <%= check_box_tag :fav %>
        <%= submit_tag("お気に入り") %>
      <% end %>

      <h3>あなたの担当患者</h3>
      <% @doctor.users.each do |ud| %>
        医師ID - <%= ud.id %> / 医師名 <%= ud.name %><br>
      <% end %>
    <% else %>
      <h3>あなたの担当医</h3>
      <% @user.doctors.each do |ud| %>
        <ul class="list-group">
          <li class="list-group-item list-group-item-success"><%= link_to ud.name, ud %></li>
        </ul>
      <% end %>
    <% end %>
</div>

<div class="ample">
  <% @user.questions.each do |question| %>
    <table class="table table-striped table-bordered">
      <tr>
        <td align="center"> 既往歴 </td>
        <td align="center"><%= question.past %></td>
      </tr>
      <tr>
        <td align="center"> 家族歴 </td>
        <td align="center"><%= question.family %></td>
      </tr>
      <tr>
        <td align="center"> アレルギー </td>
        <td align="center"><%= question.alle %></td>
      </tr>
      <tr>
        <td align="center"> 今飲んでるお薬 </td>
        <td align="center"><%= question.pharm %></td>
      </tr>
      <tr>
        <td align="center"> 生活について </td>
        <td align="center"><%= question.life %></td>
      </tr>
       <% @question_user = question.user_id
       @question_id = question.id
       @url = "/users/#{question.user_id}/questions/#{question.id}/edit"%>
    </table>
    <%= link_to '登録情報の編集',  "#{@url}" , class: "btn btn-default btn-sm" %><br>
  <% end %>

<% if @user.questions.length == 0 %>
  <%= form_for([@user, @user.questions.build]) do |f| %>
  <p>
    <%= f.label :既往歴 %><br>
    <%= f.text_area :past ,class:"form-control",placeholder:"結核,胃がん" %>
  </p>
  <p>
    <%= f.label :家族歴 %><br>
    <%= f.text_area :family ,class:"form-control",placeholder:"父が胃がん、母が乳ガンなど"%>
  </p>
  <p>
    <%= f.label :アレルギー %><br>
    <%= f.text_area :alle ,class:"form-control",placeholder:"花粉、風邪薬"%>
  </p>
  <p>
    <%= f.label :今飲んでるお薬 %><br>
    <%= f.text_area :pharm ,class:"form-control",placeholder:"胃薬、血をサラサラにする薬など"%>
  </p>
  <p>
    <%= f.label :生活について%><br>
    <%= f.text_area :life ,class:"form-control",placeholder:"喫煙10本/日,ビール1缶/日、一人暮らしなど" %>
  </p>
  <p>
    <%= f.submit :登録 %>
  </p>
  <% end %>
<% else %>
    <p></p>
<% end %>

</div>

<div class="notes">
  <p>
  <%= form_for([@user, @user.notes.build]) do |f| %>
    <%= f.label :メモ %><br>
    <%= f.text_area :note ,class:"form-control",placeholder:"ご気分はどうですか" %>

    <% if signed_in_doctor? %>
       <%= f.hidden_field :flag, :value => 2 %>
    <% else %>
       <%= f.hidden_field :flag, :value => 1 %>
    <% end %>
    <div class="f_button">
      <%= f.submit :書く %>
    </div>
  <% end %>
  </p>

  <div class="talk">
  <% @user.notes.each do |note| %>
     <% if note.flag == 2 %>
        <div class="doctor">
            Doctor ->
            <%= note.note %>
        </div>
      <% else %>
          <div class="patient">
            Patient ->
            <%= note.note %>
          </div>
      <% end %>
  <% end %>
  </div>
</div>

<div class="alert">
<% if signed_in_doctor? %> 
  <%= form_for([@user, @user.alerts.build]) do |f| %>
  <p>
    <%= f.label :タイトル %><br>
    <%= f.text_area :title ,class:"form-control", placeholder:"タイトル" %>
  </p>
  <p>
    <%= f.label :内容 %><br>
    <%= f.text_area :context ,class:"form-control", placeholder:"アラート作成" %>
  </p>
  <p>
    <%= f.label :メモ %><br>
    <%= f.datetime_field :when  %>
  </p>
    <% if signed_in_doctor? %>
      <%= f.hidden_field :doctor_id, :value => current_doctor.id %>
    <% end %>
  <%= f.submit :アラート作成 %>
 <% end %>
<% end %>

<% @user.alerts.each do |ud| %>
  <ul class="list-group">
    <li class="list-group-item list-group-item-success"><%= ud.id %> - <%= ud.when %> - <%= ud.doctor_id %></li>
  </ul>
<% end %>
</div>




